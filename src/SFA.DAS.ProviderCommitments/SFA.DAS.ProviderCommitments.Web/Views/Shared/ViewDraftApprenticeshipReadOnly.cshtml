@using SFA.DAS.CommitmentsV2.Shared.Extensions
@using SFA.DAS.CommitmentsV2.Types
@using SFA.DAS.CommitmentsV2.Api.Client
@using SFA.DAS.ProviderCommitments.Extensions
@using SFA.DAS.ProviderCommitments.Web.Extensions
@using SFA.DAS.ProviderCommitments.Web.Models
@using SFA.DAS.ProviderCommitments.Web.RouteValues
@inject ICommitmentsApiClient CommitmentsApiClient
@model SFA.DAS.ProviderCommitments.Web.Models.DraftApprenticeshipViewModel

@Html.HiddenFor(x => x.ReservationId)
@Html.HiddenFor(x => x.IsContinuation)
@Html.HiddenFor(x => x.Employer)
@Html.HiddenFor(x => x.LearnerDataId)
<input type="hidden" asp-for="HasStandardOptions" />
<input type="hidden" asp-for="TrainingCourseOption" />
<input type="hidden" asp-for="HasUnavailableFlexiJobAgencyDeliveryModel" />

@{

    string DisplayCost(int? value) => value.HasValue ? value.Value.ToGdsCostFormat() : "--";

    var startDateLabel = Model.DeliveryModel == DeliveryModel.Regular ? "Planned training start date" : "Planned apprenticeship training start date";
    var endDateLabel = Model.DeliveryModel == DeliveryModel.Regular ? "Planned training end date" : "Planned apprenticeship training end date";

    ViewBag.ValidationOrder = "FirstName,LastName,Email,DateOfBirth,Uln,StartDate,EndDate,EmploymentEndDate,Cost,EmploymentPrice,Reference";

    Model.CourseCode = ViewData.ModelState[nameof(Model.CourseCode)]?.AttemptedValue ?? Model.CourseCode;
    Model.DeliveryModel = ViewData.ModelState[nameof(Model.DeliveryModel)]?.AttemptedValue.ToEnum<DeliveryModel>() ?? Model.DeliveryModel;

    if (!string.IsNullOrWhiteSpace(Model.CourseCode))
    {
        Model.CourseName = (await CommitmentsApiClient.GetTrainingProgramme(Model.CourseCode)).TrainingProgramme.Name;
    }

    string name = $"{Model.FirstName} {Model.FirstName}";

}

<div class="govuk-width-container">
    <main class="govuk-main-wrapper" role="main">
        <div class="govuk-grid-row">
            <div class="">
                <partial name="_ValidationSummary" />
                <input type="hidden" asp-for="CourseCode" value="@Model.CourseCode">
                <input type="hidden" asp-for="DeliveryModel" value="@(Model.DeliveryModel ?? DeliveryModel.Regular)">
                <input type="hidden" asp-for="FirstName" value="@Model.FirstName">
                <input type="hidden" asp-for="LastName" value="@Model.LastName">
             

                <h1 class="govuk-heading-l">View details for @Model.FirstName @Model.LastName</h1>

                <div class="govuk-form-group">
                    <details class="govuk-details govuk-!-margin-top-2" data-module="govuk-details">
                        <summary class="govuk-details__summary">
                            <span class="govuk-details__summary-text">
                                I need to change some apprentice details
                            </span>
                        </summary>
                        <div class="govuk-details__text">
                            You will need to remove the apprentice from the cohort or delete the cohort. Then update the apprentice details in the ILR and add the apprentice again.
                        </div>
                    </details>
                </div>

                <form id="addEmail" novalidate method="post">
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">
                            Apprentice details
                        </h2>
                    </div>
                    <div class="govuk-summary-card__content">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Name
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    @name
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> name</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                    @Html.HiddenFor(x => x.Email)
                                    @Html.HiddenFor(x => x.IsContinuation)
                                    @Html.HiddenFor(x => x.LearnerDataId)
                                <dt class="govuk-summary-list__key">
                                    Email address
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    @if (string.IsNullOrEmpty(@Model.Email))
                                    {
                                        <button id="add-email-link" type="submit" name="addEmail"
                                                value="add" class="das-button--inline-link">
                                            Add Email
                                        </button>
                                    }
                                    else
                                    {
                                        @Model.Email

                                    }
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    @if (!string.IsNullOrEmpty(@Model.Email))
                                    {
                                            <button id="add-email-link" type="submit" name="addEmail"
                                                    value="add" class="das-button--inline-link">
                                                Change Email
                                            </button>
                                    }

                                </dd>

                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Date of birth
                                </dt>
                                <dd class="govuk-summary-list__value">

                                    @(Model.DateOfBirth.HasValue? Model.DateOfBirth.Date.Value.ToString("dd MMM yyyy") : "")
                                    @Html.HiddenFor(x => x.BirthDay)
                                    @Html.HiddenFor(x => x.BirthMonth)
                                    @Html.HiddenFor(x => x.BirthYear)
                                    @Html.HiddenFor(x => x.StartMonth)
                                    @Html.HiddenFor(x => x.StartYear)
                                    @Html.HiddenFor(x => x.EndDay)
                                    @Html.HiddenFor(x => x.EndMonth)
                                    @Html.HiddenFor(x => x.EndYear)
                                    @Html.HiddenFor(x => x.FirstName)
                                    @Html.HiddenFor(x => x.LastName)



                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> date of birth</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Unique learner number
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    @Model.Uln
                                    @Html.HiddenFor(x => x.Uln)
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> Unique learner number</span></a>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
              
              
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">
                            Employer
                        </h2>
                    </div>
                    <div class="govuk-summary-card__content">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Name
                                </dt>
                                <dd class="govuk-summary-list__value" id="employer-value">
                                    @Model.Employer
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> employer name</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Agreement ID
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    @Model.AgreementId
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> agreement ID</span></a>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">
                            Training dates
                        </h2>
                    </div>
                    <div class="govuk-summary-card__content">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Start date
                                </dt>
                                <dd class="govuk-summary-list__value" id="startdate-value">
                                    @(Model.StartDate.HasValue && Model.StartDate.Date.HasValue ? Model.StartDate.Date.Value.ToString("MMM yyyy") : "")
                                    @Html.HiddenFor(x => x.StartMonth)
                                    @Html.HiddenFor(x => x.StartYear)
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> start date</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Planned end date (not including end-point assessment)
                                </dt>
                                <dd class="govuk-summary-list__value" id="enddate-value">
                                    @(Model.EndDate.HasValue && Model.EndDate.Date.HasValue ? Model.EndDate.Date.Value.ToString("MMM yyyy") : "")
                                    @Html.HiddenFor(x => x.EndMonth)
                                    @Html.HiddenFor(x => x.EndYear)
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> planned end date</span></a>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">
                            Apprenticeship details
                        </h2>
                    </div>
                    <div class="govuk-summary-card__content">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Apprenticeship training course
                                </dt>
                                <dd class="govuk-summary-list__value" id="course-value">
                                    @Model.CourseName
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> Apprenticeship training course</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Maximum funding band for this course
                                </dt>
                                <dd class="govuk-summary-list__value" id="cost-value">
                                    @DisplayCost(Model.Cost)
                                    @Html.HiddenFor(x => x.Cost)
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> Apprenticeship training course</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Version
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    1.2
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> email</span></a>
                                </dd>
                            </div>
                            <div class="govuk-summary-list__row">
                                <dt class="govuk-summary-list__key">
                                    Standard option
                                </dt>
                                <dd class="govuk-summary-list__value">
                                    <a href="/training-provider/v9/approvals/select-standard-option" class="govuk-link">
                                        Add standard
                                        option
                                    </a>
                                </dd>
                                <dd class="govuk-summary-list__actions">
                                    <a class="govuk-link" href="#"><span class="govuk-visually-hidden"> standard option</span></a>
                                </dd>
                            </div>
                            
                            <div class="govuk-summary-list__row">

                                    @Html.HiddenFor(x => x.Reference)
                                <dt class="govuk-summary-list__key">
                                    Your reference (optional)
                                </dt>                               

                                    <dd class="govuk-summary-list__value">
                                        @if (string.IsNullOrEmpty(@Model.Reference))
                                        {
                                            <button id="add-email-link" type="submit" name="addReference"
                                                    value="add" class="das-button--inline-link">
                                                Add Reference
                                            </button>
                                        }
                                        else
                                        {
                                            @Model.Reference

                                        }
                                    </dd>
                                    <dd class="govuk-summary-list__actions">
                                        @if (!string.IsNullOrEmpty(@Model.Email))
                                        {
                                            <button id="add-email-link" type="submit" name="addReference"
                                                    value="Change" class="das-button--inline-link">
                                                Change
                                            </button>
                                        }

                                    </dd>
                            </div>                           
                        </dl>
                    </div>
                </div>

                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h2 class="govuk-summary-card__title">
                            Recognition of prior learning (RPL) details
                        </h2>
                        <ul class="govuk-summary-card__actions">
                            <li class="govuk-summary-card__action">
                                <a class="govuk-link" href="/training-provider/v9/approvals/recognise-prior-learning-details">Add<span class="govuk-visually-hidden"> add RPL</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="govuk-summary-card__content">
                        <dl class="govuk-summary-list">
                            <div class="govuk-summary-list__row">
                                <dd class="govuk-summary-list__value">
                                    No recognition of prior learning details added
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <a id="continue-button" role="button" draggable="false" class="govuk-button" href="/training-provider/v9/approvals/review-apprentices-1">
                    Save and submit
                </a>

                <p>
                    <a class="govuk-link govuk-link--no-visited-state" href="@Url.Action("Details", "Cohort", new { Model.ProviderId, Model.CohortReference })">
                        Cancel
                    </a>
                </p>
                </form>
            </div>
        </div>
         

    </main>
</div>
@section breadcrumb {
    <a id="back-link" class="govuk-back-link" href="@Url.Action("Details", "Cohort", new { Model.ProviderId, Model.CohortReference })">Back</a>
}