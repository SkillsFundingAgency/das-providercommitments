@model SFA.DAS.ProviderCommitments.Web.Models.PriorLearningSummaryViewModel
@using SFA.DAS.ProviderCommitments.Web.RouteValues;
@inject SFA.DAS.Authorization.Services.IAuthorizationService AuthorizationService

@{
    ViewData["Title"] = "Check your recognised prior learning";
    ViewBag.ValidationOrder = "";
    ViewBag.GaData.Vpv = "/unapproved/apprenticeship/prior-learning-summary";

}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

        <h1 class="govuk-heading-l">Check your recognised prior learning</h1>

        <partial name="_ValidationSummary" />
        <form method="post">

            @Html.HiddenFor(x => x.ProviderId)
            @Html.HiddenFor(x => x.CohortReference)
            @Html.HiddenFor(x => x.DraftApprenticeshipId)
            @Html.HiddenFor(x => x.HasStandardOptions)

            @if (Model.RplPriceReductionError.Equals(true))
            {
                <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
                    <div class="govuk-notification-banner__header">
                    <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                        Action required
                    </h2>
                </div>
                <div class="govuk-notification-banner__content">
                    <p class="govuk-notification-banner__heading">
                        RPL price reduction too low: @Model.FullName can't be approved until this is resolved.
                    </p>
                    <p class="govuk-body">
                        Price reduction is below the minimum required based on the off-the-job reduction that you have entered.
                    </p>
                    <ol class="govuk-list govuk-list--number">
                        <li>Check the price reduction.</li>
                        <li>Check the total off-the-job training time and the reduction due to RPL.</li>
                        <li>Re-enter any incorrect data</li>
                    </ol>
                </div>
                </div>
            }

            <h2 class="govuk-heading-m govuk-!-margin-top-9">Check the details of recognised prior learning</h2>

            <dl class="govuk-summary-list govuk-!-margin-bottom-9">

                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key half-column">
                        Price reduction due to RPL
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        £@Model.PriceReducedBy.GetValueOrDefault().ToString("N")
                    </dd>
                    <dd class="govuk-summary-list__actions">
                        <a class="govuk-link" href="@Url.RouteUrl(RouteNames.RecognisePriorLearningData)">
                            Change<span class="govuk-visually-hidden"> contact details</span>
                        </a>
                    </dd>
                </div>

                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Total off-the-job training time for this apprenticeship standard
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        @Model.TrainingTotalHours hours
                    </dd>
                    <dd class="govuk-summary-list__actions">
                        <a class="govuk-link" href="@Url.RouteUrl(RouteNames.RecognisePriorLearningData)">
                            Change<span class="govuk-visually-hidden"> contact details</span>
                        </a>
                    </dd>
                </div>
                <div class="govuk-summary-list__row ">
                    <dt class="govuk-summary-list__key">
                        Total reduction in off-the-job training time due to RPL
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        @Model.DurationReducedByHours hours
                    </dd>
                    <dd class="govuk-summary-list__actions">
                        <a class="govuk-link" href="@Url.RouteUrl(RouteNames.RecognisePriorLearningData)">
                            Change<span class="govuk-visually-hidden"> name</span>
                        </a>
                    </dd>
                </div>

            </dl>

            <div class="govuk-inset-text">
                <p class="govuk-body">
                    Based on the above figures that you have entered, the minimum price reduction due to RPL is <strong>£@Model.MinimumPriceReduction.GetValueOrDefault().ToString("N")</strong>.
                </p>

                <p class="govuk-body">
                    The calculation below is based on your figures.
                </p>
            </div>

            <h3 class="govuk-heading-s ">Funding calculation</h3>

            <dl class="govuk-summary-list govuk-!-margin-bottom-9">

                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Maximum funding band for this apprenticeship standard
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        £@Model.FundingBandMaximum.GetValueOrDefault().ToString("N")
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>

                <div class="govuk-summary-list__row ">
                    <dt class="govuk-summary-list__key">
                        Apprentice's training reduction due to RPL
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        @Decimal.Round(Model.PercentageOfPriorLearning.GetValueOrDefault(), 2)%
                        (@Model.DurationReducedByHours of @Model.TrainingTotalHours hours)
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Minimum price reduction due to RPL
                    </dt>
                    <dd class="govuk-summary-list__value govuk-table__cell--numeric govuk-!-text-align-left">
                        £@Model.MinimumPriceReduction.GetValueOrDefault().ToString("N")
                        (@Decimal.Round(Model.MinimumPercentageReduction.GetValueOrDefault(), 2)% of £@Model.FundingBandMaximum.GetValueOrDefault().ToString("N"))
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>

            </dl>

            <p class="govuk-body">
                The formula for the calculation above is outlined in the <a class="govuk-link" href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1155957/Apprenticeship_funding_rules_2324_Version_1.pdf">apprenticeship
                funding rules</a>.
            </p>

            <p class="govuk-body">
                If the figures you have entered are correct your organisation needs to adjust it's calculation method to make it compliant with the funding rules.
            </p>

            <input type="hidden" name="answers-checked" value="true">
            <button class="govuk-button govuk-!-margin-top-6" data-module="govuk-button">
                Save and Continue
            </button>
            <br>
        </form>

    </div>
</div>

@section breadcrumb
{
    <a id="back-link" class="govuk-back-link" href="@Url.RouteUrl(RouteNames.RecognisePriorLearningData)">Back</a>
}
